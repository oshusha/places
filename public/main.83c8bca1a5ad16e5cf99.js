!(function (t) { const e = {}; function n(o) { if (e[o]) return e[o].exports; const r = e[o] = { i: o, l: !1, exports: {} }; return t[o].call(r.exports, r, r.exports, n), r.l = !0, r.exports; }n.m = t, n.c = e, n.d = function (t, e, o) { n.o(t, e) || Object.defineProperty(t, e, { enumerable: !0, get: o }); }, n.r = function (t) { typeof Symbol !== 'undefined' && Symbol.toStringTag && Object.defineProperty(t, Symbol.toStringTag, { value: 'Module' }), Object.defineProperty(t, '__esModule', { value: !0 }); }, n.t = function (t, e) { if (1 & e && (t = n(t)), 8 & e) return t; if (4 & e && typeof t === 'object' && t && t.__esModule) return t; const o = Object.create(null); if (n.r(o), Object.defineProperty(o, 'default', { enumerable: !0, value: t }), 2 & e && typeof t !== 'string') for (const r in t)n.d(o, r, ((e) => t[e]).bind(null, r)); return o; }, n.n = function (t) { const e = t && t.__esModule ? function () { return t.default; } : function () { return t; }; return n.d(e, 'a', e), e; }, n.o = function (t, e) { return Object.prototype.hasOwnProperty.call(t, e); }, n.p = '', n(n.s = 1); }([function (t, e, n) {}, function (t, e, n) {
  n.r(e); n(0); function o(t, e) { for (let n = 0; n < e.length; n++) { const o = e[n]; o.enumerable = o.enumerable || !1, o.configurable = !0, 'value' in o && (o.writable = !0), Object.defineProperty(t, o.key, o); } } const r = (function () { function t(e) { !(function (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function'); }(this, t)), this._url = e.url, this._groupId = e.groupId, this.resources = e.resources, this._headers = e.headers, this._methods = e.methods, this._options = null; } let e; let n; let r; return e = t, (n = [{ key: '_fetch', value(t) { const e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : this._methods.get; const n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null; return this._options = n ? { headers: { authorization: this._headers.authorization, 'Content-Type': 'application/json' }, method: e, body: JSON.stringify(n) } : { headers: this._headers, method: e }, fetch(t, this._options).then(((t) => (t.ok ? t.json() : Promise.reject('Ошибка: '.concat(t.status))))).then(((t) => t)).catch(((t) => { console.log(t); })); } }, { key: 'get', value(t) { return this._fetch(''.concat(this._url).concat(this._groupId).concat(t)); } }, { key: 'put', value(t, e) { return this._fetch(''.concat(this._url).concat(this._groupId).concat(t, '/').concat(e), this._methods.put); } }, { key: 'delete', value(t, e) { return this._fetch(''.concat(this._url).concat(this._groupId).concat(t, '/').concat(e), this._methods.delete); } }, { key: 'update', value(t, e) { return this._fetch(''.concat(this._url).concat(this._groupId).concat(t), this._methods.patch, e); } }, { key: 'post', value(t, e) { return this._fetch(''.concat(this._url).concat(this._groupId).concat(t), this._methods.post, e); } }]) && o(e.prototype, n), r && o(e, r), t; }()); function i(t, e) { for (let n = 0; n < e.length; n++) { const o = e[n]; o.enumerable = o.enumerable || !1, o.configurable = !0, 'value' in o && (o.writable = !0), Object.defineProperty(t, o.key, o); } } const a = (function () { function t(e, n) { !(function (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function'); }(this, t)), this.form = e, this._errorsText = n.errorsText, this._button = this.form.querySelector('.button'), this._buttonClass = this._button.className.split(' ')[1], this._errorHtmlFields = this.form.querySelectorAll('.error-message'), this.buttonClassDisabled = `${this._buttonClass}_disabled`, this._inputs = Array.from(this.form.elements); } let e; let n; let o; return e = t, (n = [{ key: '_validate', value() { return this._inputs.every(((t) => t.checkValidity())); } }, { key: '_enableButton', value() { this._button.removeAttribute('disabled', !0), this._button.classList.remove(this.buttonClassDisabled), this._button.classList.add(this._buttonClass); } }, { key: '_disableButton', value() { this._button.setAttribute('disabled', !0), this._button.classList.add(this.buttonClassDisabled), this._button.classList.remove(this._buttonClass); } }, { key: '_removeHtmlErrors', value() { this._errorHtmlFields.forEach(((t) => t.textContent = '')); } }, { key: 'checkButton', value() { this._validate() ? (this._enableButton(), this._removeHtmlErrors()) : this._disableButton(); } }, { key: '_checkValidity', value(t, e, n) { const o = this; this._inputs.forEach(((r) => { t.name === r.name && (e && (o.form.querySelector('#'.concat(r.name)).textContent = n), t.validity.valid && (o.form.querySelector('#'.concat(r.name)).textContent = '')); })); } }, { key: 'addHtmlErrors', value(t) { const e = t.target; this._checkValidity(e, e.validity.valueMissing, this._errorsText.valueMissing), this._checkValidity(e, e.validity.tooShort, this._errorsText.tooShort), this._checkValidity(e, e.validity.typeMismatch, this._errorsText.typeMismatchLink), this._checkValidity(e, e.validity.patternMismatch, this._errorsText.patternMismatchImg); } }]) && i(e.prototype, n), o && i(e, o), t; }()); const c = {
    valueMissing: 'Это обязательное поле', tooShort: 'Должно быть от 2 до 30 символов', typeMismatchLink: 'Здесь должна быть ссылка', patternMismatchImg: 'Здесь должна быть ссылка на картинку',
  }; const s = document.querySelector('.root'); const u = document.querySelector('div.places-list'); const l = document.forms.new; const f = document.forms.profile; const p = document.forms.avatar; const d = {
    url: 'https://praktikum.tk/',
    groupId: 'cohort6',
    resources: {
      cards: '/cards', likes: '/cards/like', user: '/users/me', avatar: '/users/me/avatar',
    },
    headers: { authorization: '0c734d8b-79b8-4df9-add9-95f0c2f01c98' },
    methods: {
      get: 'GET', post: 'POST', patch: 'PATCH', put: 'PUT', delete: 'DELETE',
    },
  }; const h = { root: s, container: u }; const _ = {
    root: s, container: document.querySelector('.popup-image'), content: document.querySelector('.popup-image__image'), closeElem: document.querySelector('.popup-image__close'), isOpened: 'popup-image_is-opened', openElem: 'place-card__image',
  }; const y = {
    root: s, container: document.querySelector('.popup'), content: document.querySelector('.popup__content'), closeElem: document.querySelector('.popup__close'), isOpened: 'popup_is-opened', openElem: 'user-info__button', form: l,
  }; const v = {
    root: s, container: document.querySelector('.popup-avatar'), content: document.querySelector('.popup__content'), closeElem: document.querySelector('.popup-avatar__close'), isOpened: 'popup_is-opened', openElem: 'user-info__photo', avatarField: document.querySelector('.user-info__photo'), form: p,
  }; const b = {
    root: s, container: document.querySelector('.popup-edit'), content: document.querySelector('.popup__content'), closeElem: document.querySelector('.popup-edit__close'), isOpened: 'popup_is-opened', openElem: 'user-info__edit', form: f, userInfoNameField: document.querySelector('.user-info__name'), userInfoJobField: document.querySelector('.user-info__job'), avatar: document.querySelector('.user-info__photo'),
  }; const m = function t(e) { !(function (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function'); }(this, t)), this.id = e; }; function g(t, e) { for (let n = 0; n < e.length; n++) { const o = e[n]; o.enumerable = o.enumerable || !1, o.configurable = !0, 'value' in o && (o.writable = !0), Object.defineProperty(t, o.key, o); } } const k = (function () { function t(e) { !(function (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function'); }(this, t)), this._root = e.root, this._container = e.container, this._content = e.content, this._closeElem = e.closeElem, this._isOpened = e.isOpened, this._openElem = e.openElem; } let e; let n; let o; return e = t, (n = [{ key: '_open', value(t) { t.target.classList.contains(this._openElem) && this._container.classList.add(this._isOpened); } }, { key: '_close', value() { this._container.classList.remove(this._isOpened); } }, { key: 'addEventListeners', value() { return this._root.addEventListener('click', this._open.bind(this)), this._closeElem.addEventListener('click', this._close.bind(this)), this; } }]) && g(e.prototype, n), o && g(e, o), t; }()); function O(t) { return (O = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (t) { return typeof t; } : function (t) { return t && typeof Symbol === 'function' && t.constructor === Symbol && t !== Symbol.prototype ? 'symbol' : typeof t; })(t); } function w(t, e) { for (let n = 0; n < e.length; n++) { const o = e[n]; o.enumerable = o.enumerable || !1, o.configurable = !0, 'value' in o && (o.writable = !0), Object.defineProperty(t, o.key, o); } } function E(t, e) { return !e || O(e) !== 'object' && typeof e !== 'function' ? (function (t) { if (void 0 === t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return t; }(t)) : e; } function S(t) { return (S = Object.setPrototypeOf ? Object.getPrototypeOf : function (t) { return t.__proto__ || Object.getPrototypeOf(t); })(t); } function j(t, e) { return (j = Object.setPrototypeOf || function (t, e) { return t.__proto__ = e, t; })(t, e); } const L = (function (t) { function e(t, n, o) { let r; return (function (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function'); }(this, e)), (r = E(this, S(e).call(this, t)))._api = n, r._user = o, r; } let n; let o; let r; return (function (t, e) { if (typeof e !== 'function' && e !== null) throw new TypeError('Super expression must either be null or a function'); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), e && j(t, e); }(e, t)), n = e, (o = [{ key: 'addFormEventListeners', value() { return this._form.addEventListener('submit', this._submit.bind(this)), this._form.addEventListener('input', this._validator.checkButton.bind(this._validator)), this._form.addEventListener('input', this._validator.addHtmlErrors.bind(this._validator)), this; } }]) && w(n.prototype, o), r && w(n, r), e; }(k)); function P(t) { return (P = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (t) { return typeof t; } : function (t) { return t && typeof Symbol === 'function' && t.constructor === Symbol && t !== Symbol.prototype ? 'symbol' : typeof t; })(t); } function T(t, e) { for (let n = 0; n < e.length; n++) { const o = e[n]; o.enumerable = o.enumerable || !1, o.configurable = !0, 'value' in o && (o.writable = !0), Object.defineProperty(t, o.key, o); } } function C(t, e) { return !e || P(e) !== 'object' && typeof e !== 'function' ? (function (t) { if (void 0 === t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return t; }(t)) : e; } function x(t) { return (x = Object.setPrototypeOf ? Object.getPrototypeOf : function (t) { return t.__proto__ || Object.getPrototypeOf(t); })(t); } function q(t, e) { return (q = Object.setPrototypeOf || function (t, e) { return t.__proto__ = e, t; })(t, e); } const I = (function (t) { function e(t, n) { let o; return (function (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function'); }(this, e)), (o = C(this, x(e).call(this, t, nt, ot)))._form = t.form, o._userInfoNameField = t.userInfoNameField, o._userInfoJobField = t.userInfoJobField, o._validator = n, o; } let n; let o; let r; return (function (t, e) { if (typeof e !== 'function' && e !== null) throw new TypeError('Super expression must either be null or a function'); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), e && q(t, e); }(e, t)), n = e, (o = [{ key: '_update', value(t) { this._userInfoNameField.textContent = t.name, this._userInfoJobField.textContent = t.about; } }, { key: 'getProfile', value() { const t = this; return this._api.get(this._api.resources.user).then(((e) => { t._user.id = e._id, t._update(e), t._form.name.value = e.name, t._form.about.value = e.about, console.log(e); })), this; } }, { key: '_submit', value(t) { const e = this; t.preventDefault(); const n = this._form.name.value; const o = this._form.about.value; this._update({ name: n, about: o }), this._api.update(this._api.resources.user, { name: n, about: o }).then(((t) => e._update(t))), this._close(); } }]) && T(n.prototype, o), r && T(n, r), e; }(L)); function F(t) { return (F = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (t) { return typeof t; } : function (t) { return t && typeof Symbol === 'function' && t.constructor === Symbol && t !== Symbol.prototype ? 'symbol' : typeof t; })(t); } function M(t, e) { for (let n = 0; n < e.length; n++) { const o = e[n]; o.enumerable = o.enumerable || !1, o.configurable = !0, 'value' in o && (o.writable = !0), Object.defineProperty(t, o.key, o); } } function A(t, e) { return !e || F(e) !== 'object' && typeof e !== 'function' ? (function (t) { if (void 0 === t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return t; }(t)) : e; } function H(t) { return (H = Object.setPrototypeOf ? Object.getPrototypeOf : function (t) { return t.__proto__ || Object.getPrototypeOf(t); })(t); } function B(t, e) { return (B = Object.setPrototypeOf || function (t, e) { return t.__proto__ = e, t; })(t, e); } const D = (function (t) { function e(t, n) { let o; return (function (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function'); }(this, e)), (o = A(this, H(e).call(this, t, nt, ot)))._form = t.form, o._avatarField = t.avatarField, o._validator = n, o; } let n; let o; let r; return (function (t, e) { if (typeof e !== 'function' && e !== null) throw new TypeError('Super expression must either be null or a function'); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), e && B(t, e); }(e, t)), n = e, (o = [{ key: '_update', value(t) { this._avatarField.style.backgroundImage = 'url('.concat(t.avatar, ')'), this._form.avatar.value = t.avatar; } }, { key: 'getAvatar', value() { const t = this; return this._api.get(this._api.resources.user).then(((e) => { t._user.id = e._id, t._update(e); })), this; } }, { key: '_submit', value(t) { const e = this; t.preventDefault(), this._api.update(this._api.resources.avatar, { avatar: this._form.avatar.value }).then(((t) => e._update(t))), this._close(); } }]) && M(n.prototype, o), r && M(n, r), e; }(L)); function N(t, e) { for (let n = 0; n < e.length; n++) { const o = e[n]; o.enumerable = o.enumerable || !1, o.configurable = !0, 'value' in o && (o.writable = !0), Object.defineProperty(t, o.key, o); } } const V = (function () {
    function t(e, n) { !(function (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function'); }(this, t)), this.user = n, this.api = e; } let e; let n; let o; return e = t, (n = [{
      key: 'create',
      value(t) {
        const e = arguments.length > 1 && void 0 !== arguments[1] && arguments[1]; const n = this._isLiked(t.likes) ? 'place-card__like-icon_liked' : ''; const o = t.owner._id === this.user.id || e ? 'block' : 'none'; return '\n\t\t<div class="place-card" id="'.concat(t._id, '">\n\t\t\t<div class="place-card__image" style="background-image: url(').concat(t.link, ');">\n\t\t\t\t<button class="place-card__delete-icon" style="display: ').concat(o, '"></button>\n\t\t\t</div>\n\t\t\t<div class="place-card__description">\n\t\t\t\t<h3 class="place-card__name">').concat(t.name, '</h3>\n                <div class="place-card__like">\n                  <button class="place-card__like-icon ')
          .concat(n, '"></button>\n                    <div class="place-card__like-counter">')
          .concat(t.likes.length, '</div>\n                </div>\n\n\t\t\t</div>\n\t\t</div>\n\t\t')
          .trim();
      },
    }, { key: '_isLiked', value(t) { const e = this; return t.some(((t) => t._id === e.user.id)); } }, { key: '_unlike', value(t) { t.target.classList.contains('place-card__like-icon') && this.api.delete(this.api.resources.likes, t.target.closest('div.place-card').id).then(((e) => { t.target.closest('div.place-card').querySelector('.place-card__like-counter').textContent = e.likes.length, t.target.classList.remove('place-card__like-icon_liked'); })); } }, { key: '_like', value(t) { t.target.classList.contains('place-card__like-icon') && this.api.put(this.api.resources.likes, t.target.closest('div.place-card').id).then(((e) => { t.target.closest('div.place-card').querySelector('.place-card__like-counter').textContent = e.likes.length, t.target.classList.add('place-card__like-icon_liked'); })); } }, { key: 'toggleLike', value(t) { t.target.classList.contains('place-card__like-icon_liked') ? this._unlike(t) : this._like(t), t.stopPropagation(); } }, { key: 'remove', value(t) { t.target.classList.contains('place-card__delete-icon') && confirm('Вы действительно хотите удалить эту карточку?') && (this._api.delete(this._api.resources.cards, t.target.closest('div.place-card').id), this._container.removeChild(t.target.closest('div.place-card')), t.stopPropagation()); } }]) && N(e.prototype, n), o && N(e, o), t;
  }()); function J(t, e) { for (let n = 0; n < e.length; n++) { const o = e[n]; o.enumerable = o.enumerable || !1, o.configurable = !0, 'value' in o && (o.writable = !0), Object.defineProperty(t, o.key, o); } } const R = (function () { function t(e, n) { !(function (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function'); }(this, t)), this._container = e.container, this._root = e.root, this._card = n, this._api = n.api; } let e; let n; let o; return e = t, (n = [{ key: 'addCard', value(t) { this._container.insertAdjacentHTML('afterbegin', t); } }, { key: 'render', value() { const t = this; this._api.get(this._api.resources.cards).then(((e) => e.sort(((t, e) => t.likes.length - e.likes.length)).forEach(((e) => { t.addCard(t._card.create(e)); })))); } }, { key: 'addEventListeners', value() { return this._root.addEventListener('click', this._card.toggleLike.bind(this._card)), this._root.addEventListener('click', this._card.remove.bind(this)), this; } }]) && J(e.prototype, n), o && J(e, o), t; }()); function z(t) { return (z = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (t) { return typeof t; } : function (t) { return t && typeof Symbol === 'function' && t.constructor === Symbol && t !== Symbol.prototype ? 'symbol' : typeof t; })(t); } function G(t, e) { for (let n = 0; n < e.length; n++) { const o = e[n]; o.enumerable = o.enumerable || !1, o.configurable = !0, 'value' in o && (o.writable = !0), Object.defineProperty(t, o.key, o); } } function U(t, e) { return !e || z(e) !== 'object' && typeof e !== 'function' ? (function (t) { if (void 0 === t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return t; }(t)) : e; } function K(t) { return (K = Object.setPrototypeOf ? Object.getPrototypeOf : function (t) { return t.__proto__ || Object.getPrototypeOf(t); })(t); } function Q(t, e) { return (Q = Object.setPrototypeOf || function (t, e) { return t.__proto__ = e, t; })(t, e); } const W = (function (t) { function e(t) { return (function (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function'); }(this, e)), U(this, K(e).call(this, t)); } let n; let o; let r; return (function (t, e) { if (typeof e !== 'function' && e !== null) throw new TypeError('Super expression must either be null or a function'); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), e && Q(t, e); }(e, t)), n = e, (o = [{ key: '_open', value(t) { t.target.classList.contains(this._openElem) && (this._container.classList.add(this._isOpened), this._content.src = t.target.style.backgroundImage.slice(5, -2)); } }]) && G(n.prototype, o), r && G(n, r), e; }(k)); function X(t) { return (X = typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol' ? function (t) { return typeof t; } : function (t) { return t && typeof Symbol === 'function' && t.constructor === Symbol && t !== Symbol.prototype ? 'symbol' : typeof t; })(t); } function Y(t, e) { for (let n = 0; n < e.length; n++) { const o = e[n]; o.enumerable = o.enumerable || !1, o.configurable = !0, 'value' in o && (o.writable = !0), Object.defineProperty(t, o.key, o); } } function Z(t, e) { return !e || X(e) !== 'object' && typeof e !== 'function' ? (function (t) { if (void 0 === t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return t; }(t)) : e; } function $(t) { return ($ = Object.setPrototypeOf ? Object.getPrototypeOf : function (t) { return t.__proto__ || Object.getPrototypeOf(t); })(t); } function tt(t, e) { return (tt = Object.setPrototypeOf || function (t, e) { return t.__proto__ = e, t; })(t, e); } const et = (function (t) { function e(t, n, o) { let r; return (function (t, e) { if (!(t instanceof e)) throw new TypeError('Cannot call a class as a function'); }(this, e)), (r = Z(this, $(e).call(this, t, nt, ot)))._form = t.form, r._cardList = n, r._validator = o, r; } let n; let o; let r; return (function (t, e) { if (typeof e !== 'function' && e !== null) throw new TypeError('Super expression must either be null or a function'); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), e && tt(t, e); }(e, t)), n = e, (o = [{ key: '_submit', value(t) { const e = this; t.preventDefault(), this._api.post(this._api.resources.cards, { name: this._form.elements.place.value, link: this._form.elements.link.value }).then(((t) => e._cardList.addCard(new V(e._api, e._user).create(t, !0)))), this._form.reset(), this._validator.checkButton(), this._close(); } }]) && Y(n.prototype, o), r && Y(n, r), e; }(L)); n.d(e, 'api', (() => nt)), n.d(e, 'user', (() => ot)); var nt = new r(d); var ot = new m(nt); new I(b, new a(f, { errorsText: c }), nt, ot).getProfile().addEventListeners().addFormEventListeners(), new D(v, new a(p, { errorsText: c }), nt, ot).getAvatar().addEventListeners().addFormEventListeners(); const rt = new R(h, new V(nt, ot)); rt.addEventListeners().render(), new W(_).addEventListeners(), new et(y, rt, new a(l, { errorsText: c }), nt, ot).addEventListeners().addFormEventListeners();
}]));
